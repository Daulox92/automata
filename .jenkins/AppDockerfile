FROM debian:buster-slim as app
LABEL maintainer "Automata Team"

RUN echo "deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free" > sources.list  && \
	echo "deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free" >> sources.list  && \
	echo "deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free" >> sources.list  && \
	echo "deb https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free" >> sources.list  && \
	apt-get update && apt-get install -y --no-install-recommends curl

COPY ./automata /usr/local/bin/automata

RUN	useradd -m -u 1000 -U -s /bin/sh -d /automata automata && \
	mkdir -p /automata/.local/share/automata && \
	chown -R automata:automata /automata/.local && \
	ln -s /automata/.local/share/automata /data

USER automata
EXPOSE 30333 9933 9944
VOLUME ["/data"]

ENTRYPOINT ["/usr/local/bin/automata"]